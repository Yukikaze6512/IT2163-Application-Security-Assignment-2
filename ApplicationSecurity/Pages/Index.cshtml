@page
@model ApplicationSecurity.Pages.IndexModel
@{
    ViewData["Title"] = "Home";
    ViewData["Breadcrumb"] = "Home";
}

<div class="container-fluid px-0">
    <div class="mb-4">
        <h1 class="page-title">Welcome, @Model.FirstName @Model.LastName</h1>
        <p class="page-desc">Your membership profile information.</p>
    </div>

    <div class="d-flex flex-column gap-4">
        
        <div class="data-card">
            <div class="card-head">Profile</div>
            <div class="card-inner">
                <div class="pf">
                    <div class="pf-icon"><i data-lucide="user"></i></div>
                    <div><div class="pf-label">First Name</div><div class="pf-value">@Model.FirstName</div></div>
                </div>
                <div class="pf">
                    <div class="pf-icon"><i data-lucide="user"></i></div>
                    <div><div class="pf-label">Last Name</div><div class="pf-value">@Model.LastName</div></div>
                </div>
                <div class="pf">
                    <div class="pf-icon"><i data-lucide="users"></i></div>
                    <div><div class="pf-label">Gender</div><div class="pf-value">@Model.Gender</div></div>
                </div>
                <div class="pf">
                    <div class="pf-icon"><i data-lucide="credit-card"></i></div>
                    <div><div class="pf-label">NRIC</div><div class="pf-value"><code class="text-sm">@Model.NRIC</code></div></div>
                </div>
                <div class="pf">
                    <div class="pf-icon"><i data-lucide="mail"></i></div>
                    <div><div class="pf-label">Email</div><div class="pf-value">@Model.Email</div></div>
                </div>
                <div class="pf">
                    <div class="pf-icon"><i data-lucide="calendar"></i></div>
                    <div><div class="pf-label">Date of Birth</div><div class="pf-value">@Model.DateOfBirth.ToString("dd MMMM yyyy")</div></div>
                </div>
                <div class="pf">
                    <div class="pf-icon"><i data-lucide="file-text"></i></div>
                    <div>
                        <div class="pf-label">Resume</div>
                        <div class="pf-value">
                            @if (!string.IsNullOrEmpty(Model.ResumeFileName))
                            {
                                <a asp-page="/Index" asp-page-handler="DownloadResume" class="btn btn-o btn-sm">
                                    <i data-lucide="download" style="width:12px;height:12px;display:inline;vertical-align:-2px;"></i>
                                    @Model.ResumeFileName
                                </a>
                            }
                            else
                            {
                                <span class="text-muted fst-italic">None</span>
                            }
                        </div>
                    </div>
                </div>
                <div class="pf">
                    <div class="pf-icon"><i data-lucide="message-circle"></i></div>
                    <div><div class="pf-label">Who Am I</div><div class="pf-value">@Model.WhoAmI</div></div>
                </div>
            </div>
        </div>

        <div class="data-card">
            <div class="card-head d-flex justify-content-between align-items-center">
                <span>Active Sessions</span>
                <span class="badge bg-secondary rounded-pill text-xs">@Model.ActiveSessions.Count active</span>
            </div>
            <div class="card-inner">
                @if (Model.ActiveSessions.Any())
                {
                    <div class="table-responsive">
                        <table class="table table-sm table-borderless align-middle mb-0">
                            <thead class="text-muted small border-bottom">
                                <tr>
                                    <th class="pb-2">Device / Browser</th>
                                    <th class="pb-2">IP Address</th>
                                    <th class="pb-2">Last Active</th>
                                    <th class="pb-2 text-end">Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var session in Model.ActiveSessions)
                                {
                                    <tr class="border-bottom-0">
                                        <td class="py-3">
                                            <div class="d-flex align-items-center gap-2">
                                                <div class="pf-icon" style="width:2rem;height:2rem;">
                                                    <i data-lucide="monitor"></i>
                                                </div>
                                                <div class="small text-truncate" style="max-width: 200px;" title="@session.UserAgent">
                                                    @session.UserAgent
                                                </div>
                                            </div>
                                        </td>
                                        <td class="small">@session.IpAddress</td>
                                        <td class="small text-muted">@session.LastActiveAt.ToLocalTime().ToString("MMM dd, HH:mm")</td>
                                        <td class="text-end">
                                            @if (session.SessionId == Model.CurrentSessionId)
                                            {
                                                <span class="badge bg-success bg-opacity-10 text-success rounded-pill border border-success border-opacity-25 px-2">Current</span>
                                            }
                                            else
                                            {
                                                <span class="badge bg-secondary bg-opacity-10 text-secondary rounded-pill border border-secondary border-opacity-25 px-2">Active</span>
                                            }
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                }
                else
                {
                    <p class="text-muted text-center py-3 mb-0 small">No active sessions found.</p>
                }
            </div>
        </div>

        <div class="data-card">
            <div class="card-head d-flex justify-content-between align-items-center flex-shrink-0">
                <span>Activity Log</span>
            </div>
            <div class="card-inner" style="max-height: 60vh; overflow-y: auto;">
                @if (Model.AuditLogs.Any())
                {
                    <div class="table-responsive">
                        <table class="table table-sm table-borderless align-middle mb-0">
                            <thead class="text-muted small border-bottom sticky-top bg-white">
                                <tr>
                                    <th class="pb-2">Time</th>
                                    <th class="pb-2">Activity</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var log in Model.AuditLogs)
                                {
                                    <tr class="border-bottom">
                                        <td class="py-2 small text-muted text-nowrap" style="vertical-align: top;">
                                            @log.Timestamp.ToLocalTime().ToString("MMM dd")<br/>
                                            @log.Timestamp.ToLocalTime().ToString("HH:mm")
                                        </td>
                                        <td class="py-2 small">
                                            <div class="fw-medium text-truncate" title="@log.Action">@log.Action</div>
                                            <div class="text-muted text-xs text-truncate" style="max-width: 300px;" title="@log.Details">
                                                @log.Details
                                            </div>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                }
                else
                {
                    <p class="text-muted text-center py-3 mb-0 small">No activity logged yet.</p>
                }
            </div>
        </div>

    </div>
</div>